<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.dao.OrderItemDao">

<!-- 단건구매 -->
<insert id="insert" parameterType="int">
	insert order_item into
		(order_id,
		 product_idx,
		 product_name,
		 product_cnt,
		 product_amount,
		 total_amount,
		 order_time
		) values (
		 #{item.order_id},
		 #{item.product_idx},
		 #{item.product_name},
		 #{item.product_cnt},
		 #{item.product_amount},
		 #{item.total_amount},
		 now()
		)
</insert>

<!-- 여러건 -->
<insert id="insertProducts" parameterType="list">
	insert order_item into
		(order_id,
		 product_idx,
		 product_name,
		 product_cnt,
		 product_amount,
		 total_amount,
		 order_time
		) values 
		<foreach collection="list" item="item" separator=",">
		(
		 #{item.order_id},
		 #{item.product_idx},
		 #{item.product_name},
		 #{item.product_cnt},
		 #{item.product_amount},
		 #{item.total_amount},
		 now()
		)
		</foreach>
</insert>

<!-- 주문별 상품 목록 조회 -->
<select id="selectListByOrderId" parameterType="int" resultType="order_item">
	select
		oi.order_item_id,
        oi.order_id,
        oi.product_idx,
        oi.product_name,
        oi.product_cnt,
        oi.product_amount,
        oi.total_amount,
        oi.order_time,
        pi.product_image_url
    from order_item oi
    left join product_image pi ON oi.product_idx = pi.product_idx 
        and pi.product_image_level = 1
    where oi.order_id = #{order_id}
    order by oi.order_item_id
</select>

<select id="selectOne" parameterType="int" resultType="order_item">
    select 
        oi.*,
        pi.product_image_url
    from order_item oi
    left join product_image pi ON oi.product_idx = pi.product_idx 
        and pi.product_image_level = 1
    where oi.order_item_id = #{order_item_id}
</select>

</mapper>