<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.dao.TestProductDao">

    <!-- 상품 목록 (이미지 포함) -->
    <select id="selectListWithImage" parameterType="map" resultType="product">
        SELECT 
            p.product_idx,
            p.category_idx,
            p.product_wishlist,
            p.product_price,
            p.product_name,
            p.product_brand,
            p.product_comment,
            p.product_cnt,
            p.product_time,
            p.product_update,
            c.category_name,
            pi.product_image_url,
            pi.product_image_level
        FROM product p
        LEFT JOIN category c ON p.category_idx = c.category_idx
        LEFT JOIN product_image pi ON p.product_idx = pi.product_idx 
            AND pi.product_image_level = 1
        <where>
            <if test="category_idx != 0 and category_idx != null">
                p.category_idx = #{category_idx}
            </if>
            <if test="keyword != null and keyword != ''">
                <if test="category_idx != 0 and category_idx != null">
                    AND 
                </if>
                p.product_name LIKE CONCAT('%', #{keyword}, '%')
            </if>
        </where>
        ORDER BY p.product_idx DESC
    </select>
    
    <!-- 상품 상세 (이미지 포함) -->
    <select id="selectOneWithImage" parameterType="int" resultType="product">
        SELECT 
            p.product_idx,
            p.category_idx,
            p.product_wishlist,
            p.product_price,
            p.product_name,
            p.product_brand,
            p.product_comment,
            p.product_cnt,
            p.product_time,
            p.product_update,
            c.category_name,
            pi.product_image_url,
            pi.product_image_level
        FROM product p
        LEFT JOIN category c ON p.category_idx = c.category_idx
        LEFT JOIN product_image pi ON p.product_idx = pi.product_idx 
            AND pi.product_image_level = 1
        WHERE p.product_idx = #{product_idx}
    </select>
    
</mapper>
