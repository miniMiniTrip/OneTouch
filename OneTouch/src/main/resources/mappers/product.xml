<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onetouch.dao.ProductDao">

  <select id="selectList" parameterType="map" resultType="product">
     SELECT 
        product.*, 
        category.category_name
        ,product_image.product_image_url
     FROM product 
     LEFT JOIN category ON product.category_idx = category.category_idx 
     left join product_image on product.product_idx=product_image.product_idx
     
     <where>
        <if test="category_idx != 0 and category_idx != null">
           product.category_idx = #{category_idx}
        </if>
        
        <if test="keyword != null and keyword != ''">
           <if test="category_idx != 0 and category_idx != null">
               AND 
           </if>
           product.product_name LIKE CONCAT('%', #{keyword}, '%')
        </if>
     </where>
     ORDER BY product.product_idx DESC
  </select>
  
  <select id="selectOne" parameterType="int" resultType="product">
     select * from product where product_idx=#{ product_idx }
  </select>
  
  <insert id="insert"  parameterType="product" useGeneratedKeys="true" keyProperty="product_idx">
     insert into product (category_idx, product_wishlist, product_price, product_name, product_brand, product_comment, product_cnt, product_time, product_update) 
     values(
        #{ category_idx },
        #{ product_wishlist },
        #{ product_price },
        #{ product_name },
        #{ product_brand },
        #{ product_comment },
        #{ product_cnt }, 
        NOW(),
        NOW()
     )
  </insert>
     <!-- 여러 idx로 상품 조회 -->
     <select id="selectByIds" parameterType="list" resultType="product">
        SELECT 
            product_idx,
            category_idx,
            product_wishlist,
            product_price,
            product_name,
            product_brand,
            product_comment,
            product_cnt,
            product_time,
            product_update
        FROM product
        WHERE product_idx IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        ORDER BY product_cnt DESC
    </select>
    
    <!-- 상품이미지테이블에 상품이미지 등록 -->
    <insert id="productImageInsert" parameterType="product">
     insert into product_image
     (product_image_idx,product_idx,product_image_url)
     values
     (null,#{product_idx},#{product_image_url})
    </insert>

</mapper>