<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.onetouch.dao.ProductDao">

  <!-- 상품 목록 조회 (카테고리 정보 포함) -->
  <select id="selectList" resultType="product">
    SELECT 
      p.product_idx,
      p.category_idx,
      p.product_like,
      p.product_price,
      p.product_name,
      p.product_brand,
      p.product_comment,
      p.product_cnt,
      p.product_time,
      p.product_update,
      c.category_name
    FROM 
      product p
    LEFT JOIN
      category c ON p.category_idx = c.category_idx
    ORDER BY 
      p.product_idx DESC
  </select>
  
  <!-- 상품 등록 -->
  <insert id="insert" parameterType="product" 
          useGeneratedKeys="true" 
          keyProperty="product_idx"> 
    INSERT INTO product (
      category_idx,
      product_price,
      product_name,
      product_brand,
      product_comment,
      product_cnt,
      product_image_url  ) VALUES (
      #{category_idx},
      #{product_price},
      #{product_name},
      #{product_brand},
      #{product_comment},
      #{product_cnt},
      #{product_image_url}
    )
  </insert>
  <!-- 상품 상세 조회 (이미지 정보 포함) -->
  <select id="selectOne" parameterType="int" resultType="product">
    SELECT 
      p.product_idx,
      p.category_idx,
      p.product_like,
      p.product_price,
      p.product_name,
      p.product_brand,
      p.product_comment,
      p.product_cnt,
      p.product_time,
      p.product_update,
      c.category_name
    FROM 
      product p
    LEFT JOIN
      category c ON p.category_idx = c.category_idx
    WHERE 
      p.product_idx = #{product_idx}
  </select>
  
  <!-- 상품 이미지 조회 -->
  <select id="selectProductImages" parameterType="int" resultType="product">
    SELECT 
      product_image_idx,
      product_idx,
      product_image_url,
      product_image_level
    FROM 
      product_image
    WHERE 
      product_idx = #{product_idx}
    ORDER BY 
      product_image_level ASC
  </select>

</mapper>